<?xml version="1.0" encoding="utf-8"?>

<resources>

    <!-- Creates the database. -->
    <string name="SQL_on_create" translatable="false">
        CREATE TABLE trip (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
                           title TEXT NOT NULL,
                           description TEXT,
                           begin_date TIMESTAMP NOT NULL,
                           end_date TIMESTAMP);

        CREATE TABLE journey (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
                              title TEXT NOT NULL,
                              description TEXT,
                              journey_date TIMESTAMP NOT NULL,
                              total_time INTEGER DEFAULT -1,
                              total_distance DOUBLE default -1);
        
        CREATE TABLE trip_location (id INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL,
                                    id_journey INTEGER NOT NULL,
                                    location_time TIMESTAMP NOT NULL,
                                    latitude REAL NOT NULL,
                                    longitude REAL NOT NULL,
                                    altitude REAL,
                                    speed REAL,
                                    accuracy REAL,
                                    bearing REAL,
                                    provider TEXT,
                                    FOREIGN KEY(id_trip) REFERENCES trip(id));

        CREATE INDEX idx_location_trip ON trip_location (id_journey);
        CREATE INDEX idx_location_time ON trip_location (location_time ASC);
    </string>

    <!-- Drop all the tables. -->
    <!--DROP TABLE trip_location;-->
    <!--DROP TABLE trip;-->
    <string name="SQL_on_upgrade" translatable="false">
    <![CDATA[
        ALTER TABLE trip ADD COLUMN total_time INTEGER DEFAULT -1;
        ALTER TABLE trip ADD COLUMN total_distance DOUBLE default -1;
    ]]>
    </string>

    <string name="SQL_reindex" translatable="false">
    <![CDATA[
            REINDEX idx_location_trip;
            REINDEX idx_location_time;
    ]]>
    </string>

    
    <string name="SQL_get_last_active_trip">
        <![CDATA[
            SELECT *
            FROM trip
            WHERE date(trip_date / 1000, \'unixepoch\', \'localtime\') =  date (\'now\')
        ]]>
    </string>

    <string name="SQL_get_all_trips">
        <![CDATA[
            SELECT * FROM trip ORDER BY trip_date DESC
        ]]>
    </string>

</resources>